# テストシナリオと結果

以下は、Firebase 認証機能と Stripe 決済機能に対する単体テストのシナリオとその結果をまとめたものです。

## 目次

1. [Firebase 認証テスト](#firebase-認証テスト)
   - [テストシナリオと結果](#firebase-テストシナリオと結果)
2. [Stripe 決済テスト](#stripe-決済テスト)
   - [テストシナリオと結果](#stripe-テストシナリオと結果)
3. [結論](#結論)
4. [補足情報](#補足情報)

---

## Firebase 認証テスト

### Firebase テストシナリオと結果

| テスト番号 | テストケース                                                         | 期待される結果                                        | 結果    |
| ---------- | -------------------------------------------------------------------- | ----------------------------------------------------- | ------- |
| 1          | ユーザーが正しくサインインできる                                     | サインインが成功し、ユーザー情報が正しく取得される    | ✅ 合格 |
| 2          | ユーザーが正しくサインアウトできる                                   | サインアウトが成功し、認証状態が`null`になる          | ✅ 合格 |
| 3          | サインアウト後の認証状態を確認する                                   | サインアウト後に`currentUser`が`null`であることを確認 | ✅ 合格 |
| 4          | 無効なパスワードでサインインしようとした場合のエラーハンドリング     | 適切なエラーメッセージが返される                      | ✅ 合格 |
| 5          | 無効なメールアドレスでサインインしようとした場合のエラーハンドリング | 適切なエラーメッセージが返される                      | ✅ 合格 |
| 6          | 空のメールアドレスでサインインしようとした場合のエラーハンドリング   | 適切なエラーメッセージが返される                      | ✅ 合格 |
| 7          | 空のパスワードでサインインしようとした場合のエラーハンドリング       | 適切なエラーメッセージが返される                      | ✅ 合格 |
| 8          | ユーザーがサインイン後に認証状態が正しく設定されることを確認         | `currentUser`が正しいユーザー情報を保持している       | ✅ 合格 |

---

## Stripe 決済テスト

### Stripe テストシナリオと結果

| テスト番号 | テストケース                                                            | 期待される結果                                                  | 結果    |
| ---------- | ----------------------------------------------------------------------- | --------------------------------------------------------------- | ------- |
| 1          | 正常にセッションが作成され、URL が返される                              | セッション作成が成功し、正しい URL が返される                   | ✅ 合格 |
| 2          | 環境変数が設定されていない場合のエラーハンドリング                      | 適切なエラーメッセージと共に 500 エラーが返される               | ✅ 合格 |
| 3          | 無効な `priceId` でリクエストした場合のバリデーションエラーハンドリング | 適切なエラーメッセージと共に 400 エラーが返される               | ✅ 合格 |
| 4          | Stripe API がエラーを返した場合のエラーハンドリング                     | 適切なエラーメッセージと共に 500 エラーが返される               | ✅ 合格 |
| 5          | レスポンスが期待通りの形式であることを確認                              | レスポンスに`url`プロパティが含まれ、値が文字列であることを確認 | ✅ 合格 |
| 6          | API レスポンスタイムのパフォーマンステスト                              | レスポンスタイムが 1 秒未満であることを確認                     | ✅ 合格 |

---

## 結論

テスト実行時間:

Firebase Authentication テスト: 5.585 秒<br>
Stripe Checkout API テスト: 5.426 秒

合計テスト数: 14

合計パスしたテスト数: 14

---

## 補足情報

### 使用した技術とライブラリ

- **テストフレームワーク**: [Jest](https://jestjs.io/)
- **Firebase 認証**: [Firebase Auth](https://firebase.google.com/docs/auth)
- **決済処理**: [Stripe API](https://stripe.com/docs/api)

### モックの活用

テストにおいて、外部サービスへの依存を排除し、テストの安定性と速度を向上させるために、以下のモックを使用しました。

- **Firebase Auth のモック**: `firebase/auth`モジュールをモック化し、サインイン・サインアウトの挙動を再現。
- **Stripe API のモック**: `stripe`モジュールをモック化し、セッション作成とエラーハンドリングの挙動を再現。
